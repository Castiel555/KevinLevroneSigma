<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Students Browser</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container py-4">
        <h1 class="mb-3">Students</h1>

        <div class="card mb-3">
            <div class="card-body">
                <form id="filters" class="row g-2">
                    <div class="col-sm-2">
                        <label class="form-label">City</label>
                        <input class="form-control" name="city" placeholder="Ko�ice">
                    </div>
                    <div class="col-sm-2">
                        <label class="form-label">Gender</label>
                        <select class="form-select" name="gender">
                            <option value="">(any)</option>
                            <option>Male</option>
                            <option>Female</option>
                        </select>
                    </div>
                    <div class="col-sm-3">
                        <label class="form-label">Name contains</label>
                        <input class="form-control" name="name" placeholder="Kevin">
                    </div>
                    <div class="col-sm-2">
                        <label class="form-label">Min weight</label>
                        <input class="form-control" name="min_weight" type="number" step="1">
                    </div>
                    <div class="col-sm-2">
                        <label class="form-label">Max weight</label>
                        <input class="form-control" name="max_weight" type="number" step="1">
                    </div>
                    <div class="col-sm-1 d-flex align-items-end">
                        <button class="btn btn-primary w-100" type="submit">Filter</button>
                    </div>
                </form>

                <div class="mt-2 d-flex gap-2">
                    <div class="btn-group">
                        <button id="loadDb" class="btn btn-outline-success">Load from DB</button>
                        <button id="loadJson" class="btn btn-outline-secondary">Load from JSON</button>
                    </div>
                    <div class="ms-auto">
                        <select id="orderBy" class="form-select">
                            <option value="Id">Order by: Id</option>
                            <option value="Name">Name</option>
                            <option value="City">City</option>
                            <option value="Gender">Gender</option>
                            <option value="Weight">Weight</option>
                            <option value="Bench">Bench</option>
                        </select>
                    </div>
                    <div>
                        <select id="orderDir" class="form-select">
                            <option value="asc">Asc</option>
                            <option value="desc">Desc</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <div class="table-responsive">
            <table class="table table-striped table-bordered align-middle" id="tbl">
                <thead class="table-light">
                    <tr>
                        <th>Id</th>
                        <th>Name</th>
                        <th>Gender</th>
                        <th>City</th>
                        <th>Weight (kg)</th>
                        <th>Bench (kg)</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <p class="text-muted">
            Tip: V DB m� rovnak� st�pce ako v C# appke � vie� filtrova� pod�a parametrov hore.
        </p>
    </div>

    <script>
        const tbody = document.querySelector("#tbl tbody");
        let source = "db"; // "db" alebo "json"

        function buildQuery() {
            const fd = new FormData(document.getElementById("filters"));
            const q = new URLSearchParams();
            for (const [k, v] of fd.entries()) if (v) q.set(k, v);
            q.set("order_by", document.getElementById("orderBy").value);
            q.set("order_dir", document.getElementById("orderDir").value);
            q.set("limit", "200"); // pre demo
            return q.toString();
        }

        async function load() {
            const url = source === "db" ? "/students" : "/students/json";
            const res = await fetch(`${url}?${buildQuery()}`);
            const data = await res.json();
            render(data);
        }

        function render(rows) {
            tbody.innerHTML = "";
            (rows || []).forEach(r => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
            <td>${r.Id ?? ""}</td>
            <td>${r.Name ?? ""}</td>
            <td>${r.Gender ?? ""}</td>
            <td>${r.City ?? ""}</td>
            <td>${r.Weight ?? ""}</td>
            <td>${r.Bench ?? ""}</td>`;
                tbody.appendChild(tr);
            });
        }

        document.getElementById("filters").addEventListener("submit", (e) => {
            e.preventDefault(); load();
        });
        document.getElementById("loadDb").addEventListener("click", () => { source = "db"; load(); });
        document.getElementById("loadJson").addEventListener("click", () => { source = "json"; load(); });
        document.getElementById("orderBy").addEventListener("change", load);
        document.getElementById("orderDir").addEventListener("change", load);

        // auto-load on start
        load();
    </script>
</body>
</html>
